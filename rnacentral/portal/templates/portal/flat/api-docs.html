<!--
Copyright [2009-2014] EMBL-European Bioinformatics Institute
Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at
     http://www.apache.org/licenses/LICENSE-2.0
Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

{% extends "portal/base.html" %}
{% load markdown_deux_tags %}

{% block title %}
RNAcentral API Documentation
{% endblock %}

{% block content %}

<div class="row">

  <div class="col-md-9" role="main">

{% markdown %}

<h1 id="overview">API overview</h1>

Most data in RNAcentral can be accessed programmatically using a RESTful API
allowing for integration with other resources.
The API implementation is based on the <a href="http://www.django-rest-framework.org/" target="_blank">Django Rest Framework</a>.

<h2 id="web-browsable-api">Web browsable API</h2>

The RNAcentral API is web browsable, which means that depending on whether
a URL is viewed in a browser or is retrieved programmatically,
the response is rendered either in human- or computer-friendly formats.

Moreover, many resources are hyperlinked so that it's possible to navigate the API without leaving the browser.

As a result, developers can familiarise themselves with the API and get a better sense of the data.

<a href="/api/v1" class="btn btn-primary" role="button" target="_blank">Browse the API</a>

<h2 id="versioning">Versioning</h2>

To ensure that changes in the RNAcentral API don't break any applications
relying on it, the API is versioned, and the version is included in the API's URL.

For example, the current API is at Version 1 and is available at <a href="/api/v1" target="_blank">{{ BASE_URL }}/api/v1</a>,
and the next version will be available at <a href="/api/v2" target="_blank">{{ BASE_URL }}/api/v2</a>.

The **latest version** of the API can be accessed at <a href="/api/current" target="_blank">{{ BASE_URL }}/api/current</a>,
but it's not recommended to use this endpoint for long-term
development as the underlying data model may change.

No **backward-incompatible changes** are made to each version after it's been made public.
More specifically, it's guaranteed that within one version there will be no:

* changing urls
* deleting or renaming data fields
* changing data field types

The following **non-disruptive changes** may be implemented to a public API:

* adding new endpoints
* adding new data fields
* adding new filtering methods

An advance notice will be given before obsoleting an API version. To stay up to date,
please consider signing up for <a href="#">RNAcentral updates</a>.

<h2 id="throttling">Throttling</h2>

The maximum number of requests from the same IP address is limited to <strong>10</strong> per second.
Currently there is no limit to the total number of requests from the same IP.

It is possible to lift the limit for registered users, so please get in touch if you require
a higher throttling limit.

<hr>

<h2 id="v1">API v1 documentation <small><span class="label label-success">current version</span></small></h2>

<h3 id="v1-example-response">Example response</h3>

This is an example response containing a single entry:

    {{ BASE_URL }}/api/v1/rna/?md5=06808191a979cc0b933265d9a9c213fd
    {
        "count": 1, // number of entries
        "next": null, // url for the next results page, default=null
        "previous": null, // url for the previous results page, default=null
        "results": [ // an array with result objects
            {
                "url": "{{ BASE_URL }}/api/v1/rna/UPI0000000001/",
                "upi": "UPI0000000001",
                "md5": "06808191a979cc0b933265d9a9c213fd",
                "sequence": "CUGAAUAAAUAAGGUAUCUUAUAUCUUUUAAUUAACAGUUAAACGCUUCCAUAAAGCUUUUAUCCA",
                "length": 66,
                "xrefs": "{{ BASE_URL }}/api/v1/rna/UPI0000000001/xrefs/"
            }
        ]
    }

<h3 id="v1-pagination">Pagination</h3>

All responses are paginated to prevent accidental downloads of large amounts of data and to speed up the API.

The urls for the *next* and *previous* pages are present in every response object.
To navigate between pages, specify the <code>page</code> parameter.

The default page size is <strong>10</strong> entries, but it can be adjusted by specifying the <code>page_size</code> parameter.
The maximum value of <code>page_size</code> is <strong>100</strong>.

<h4>Examples</h4>

* <a href="/api/v1/rna/?page_size=5" target="_blank">{{ BASE_URL }}/api/v1/rna/?page_size=5</a>
* <a href="/api/v1/rna/?page=2&page_size=5" target="_blank">{{ BASE_URL }}/api/v1/rna/?page_size=5&page=2</a></p>

<h3 id="v1-output-formats">Output formats</h3>

The same url can be viewed in the browser in a human-readable form
and accessed programmatically in a computer-readable form using a process
called content negotiation.

The following output formats are currently supported, with more options coming soon:

* <strong>JSON</strong>
* <strong>YAML</strong>
* <strong>HTML</strong>

The output format can be specified using the <code>format</code> url parameter.

#### Examples

* <a href="/api/v1/rna/UPI0000000001/?format=json" target="_blank">{{ BASE_URL }}/api/v1/rna/UPI0000000001/?format=json</a>
* <a href="/api/v1/rna/UPI0000000001/?format=yaml" target="_blank">{{ BASE_URL }}/api/v1/rna/UPI0000000001/?format=yaml</a>
* <a href="/api/v1/rna/UPI0000000001/?format=api"  target="_blank">{{ BASE_URL }}/api/v1/rna/UPI0000000001/?format=api</a>

Alternatively, one can set the format using the Accept headers:

    curl -H "Accept: application/json" {{ BASE_URL }}/api/v1/rna/UPI0000000001
    curl -H "Accept: application/yaml" {{ BASE_URL }}/api/v1/rna/UPI0000000001
    curl -H "Accept: text/html" {{ BASE_URL }}/api/v1/rna/UPI0000000001

In case the Accept headers contradict the url parameter, an error message is returned:

    curl -H "Accept: application/json" {{ BASE_URL }}/api/v1/?format=yaml
    {
      "detail": "Could not satisfy the request's Accept header"
    }

<h3 id="v1-filtering">Filtering</h3>

The API provides several basic filtering operations and complements the main search functionality.

<h4>Examples</h4>

* filter by sequence length
<a href="/api/v1/rna/?length=2014" target="_blank">{{ BASE_URL }}/api/v1/rna/?length=2014</a>
* filter by Expert Database

<div class="col-md-8">
  <table class="table table-condensed">
    <tr><th>Database</th><th>Request</th></tr>
    <tr><td>ENA</td><td><a href="/api/v1/rna/?database=1" target="_blank">{{ BASE_URL }}/api/v1/rna/?database=1</a></td></tr>
    <tr><td>RFAM</td><td><a href="/api/v1/rna/?database=2" target="_blank">{{ BASE_URL }}/api/v1/rna/?database=2</a></td></tr>
    <tr><td>SRPDB</td><td><a href="/api/v1/rna/?database=3" target="_blank">{{ BASE_URL }}/api/v1/rna/?database=3</a></td></tr>
    <tr><td>miRBase</td><td><a href="/api/v1/rna/?database=4" target="_blank">{{ BASE_URL }}/api/v1/rna/?database=4</a></td></tr>
    <tr><td>VEGA</td><td><a href="/api/v1/rna/?database=5" target="_blank">{{ BASE_URL }}/api/v1/rna/?database=5</a></td></tr>
    <tr><td>tmRNA Website</td><td><a href="/api/v1/rna/?database=6" target="_blank">{{ BASE_URL }}/api/v1/rna/?database=6</a></td></tr>
  </table>
</div>

<h3 id="v1-example-scripts">Example scripts</h3>

Two example scripts for looking up RNAcentral unique sequence ids (URS) are provided.

<script src="https://gist.github.com/AntonPetrov/177cef0a3b4799f01536.js"></script>

{% endmarkdown %}

  <hr>

  </div>

  <nav id="affix-nav" class="sidebar col-md-3 hidden-print visible-lg" role="complementary">
    <ul class="nav sidenav affix" data-spy="affix" id="affix-ul">
        <li>
          <a href="#overview">API Overview</a>
          <ul class="nav">
            <li><a href="#web-browsable-api">Web browsable API</a></li>
            <li><a href="#versioning">Versioning</a></li>
            <li><a href="#throttling">Throttling</a></li>
          </ul>
        </li>
        <li>
          <a href="#v1">API v1 documentation</a>
          <ul class="nav">
            <li><a href="#v1-example-response">Example response</a></li>
            <li><a href="#v1-pagination">Pagination</a></li>
            <li><a href="#v1-output-formats">Output formats</a></li>
            <li>
              <a href="#v1-filtering">Fitlering</a>
              <ul class="nav">
                <li><a href="#v1-filtering-by-length">Filtering by length</a></li>
              </ul>
            </li>
            <li><a href="#v1-example-scripts">Example scripts</a></li>
          </ul>
        </li>
    </ul>
  </nav>

</div>

{% endblock content %}


{% block extra_js %}
  {{ block.super }}

  <script type="text/javascript">
    $(function() {
      $('body').scrollspy({ target: '#affix-nav' });
      var $affix = $("#affix-ul");
      $affix.affix({
        offset: {
            top: 50
        }
      }).width($affix.parent().width());
      $(window).resize(function () {
        $affix.width($affix.parent().width());
      });
    });
  </script>
{% endblock extra_js %}
