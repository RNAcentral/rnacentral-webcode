<!--
Copyright [2009-2014] EMBL-European Bioinformatics Institute
Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at
     http://www.apache.org/licenses/LICENSE-2.0
Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

{% extends "portal/base.html" %}
{% load markdown_deux_tags %}

{% block title %}
RNAcentral API Documentation
{% endblock %}

{% block content %}

<div class="row">

  <div class="col-md-9" role="main">

{% markdown %}

<h1 id="overview">API overview</h1>

Most data in RNAcentral can be accessed programmatically using a RESTful API
allowing for integration with other resources.
The API implementation is based on the [Django Rest Framework](http://www.django-rest-framework.org/).

<h2 id="web-browsable-api">Web browsable API</h2>

The RNAcentral API is **web browsable**, which means that:

* the data is served in either **human- or computer-friendly formats** depending on whether
a URL is viewed in a browser or is retrieved programmatically

* many resources are **hyperlinked** so that it's possible to navigate the API in the browser.

As a result, developers can familiarise themselves with the API and get a better sense of the RNAcentral data.

<a href="/api/v1" class="btn btn-primary" role="button" target="_blank">Browse the API</a>

<h2 id="versioning">Versioning</h2>

To ensure that changes in the RNAcentral API don't break any applications
relying on it, the API is versioned, and **the version is included in the API's URL**.

For example, the **current API is at Version 1** and is available at [{{ BASE_URL }}/api/v1](/api/v1),
and the next version will be available at [{{ BASE_URL }}/api/v2](/api/v2).

The **latest version** of the API can be accessed at [{{ BASE_URL }}/api/current](/api/current),
but it's not recommended to use this endpoint for long-term
development as the underlying data model may change.

No **backward-incompatible changes** are made to each version after it's been made public.
More specifically, it's guaranteed that within one version there will be no:

* changing urls
* deleting or renaming data fields
* changing data field types

The following **non-disruptive changes** may be implemented to a public API:

* adding new endpoints
* adding new data fields
* adding new filtering methods

An advance notice will be given before obsoleting an API version. To stay up to date,
please consider signing up for the [RNAcentral updates](#).

<h2 id="throttling">Throttling</h2>

The maximum number of requests from the same IP address is limited to **20 requests per second**.
Currently there is no limit on the total number of requests from the same IP.

The limit can be lifted for registered users, so please get in touch if you require a higher request rate.

<hr>

<h1 id="v1">API v1 documentation <small><span class="label label-success">current version</span></small></h1>

<h2 id="v1-example-response">Example response</h2>

This is an example response containing a single entry:

```
{{ BASE_URL }}/api/v1/rna/?md5=06808191a979cc0b933265d9a9c213fd

{
    "count": 1, // number of entries
    "next": null, // url for the next results page, default=null
    "previous": null, // url for the previous results page, default=null
    "results": [ // an array with result objects
        {
            "url": "{{ BASE_URL }}/api/v1/rna/URS0000000001/",
            "rnacentral_id": "URS0000000001",
            "md5": "06808191a979cc0b933265d9a9c213fd",
            "sequence": "CUGAAUAAAUAAGGUAUCUUAUAUCUUUUAAUUAACAGUUAAACGCUUCCAUAAAGCUUUUAUCCA",
            "length": 66,
            "xrefs": "{{ BASE_URL }}/api/v1/rna/URS0000000001/xrefs/"
        }
    ]
}
```

<h3 id="v1-hyperlinked-vs-flat-responses">Hyperlinked vs flat responses</h3>

By default cross-references are represented by a hyperlink in the default RNA object, for example:

```
"xrefs": "{{ BASE_URL }}/api/v1/rna/URS0000000001/xrefs/"
```

Sometimes it is desirable to retrieve all nested objects in a single request,
which can be done using the `flat=true` url parameter.
Note that such requests may take longer.

#### Examples

* [{{ BASE_URL }}/api/v1/rna/](/api/v1/rna/) (hyperlinked)
* [{{ BASE_URL }}/api/v1/rna/?flat=true](/api/v1/rna/?flat=true) (flat)
* [{{ BASE_URL }}/api/v1/rna/URS0000000001](/api/v1/rna/URS0000000001) (hyperlinked)
* [{{ BASE_URL }}/api/v1/rna/URS0000000001/?flat=true](/api/v1/rna/URS0000000001/?flat=true) (flat)

<h2 id="v1-pagination">Pagination</h2>

All responses are paginated to prevent accidental downloads of large amounts of data and to speed up the API.

The urls for the *next* and *previous* pages are present in every response object.

To navigate between pages, specify the `page` parameter.

The page size is controlled by the `page_size` parameter. Its default value is
**10 entries per page**, and the maximum number of entries per page is **100**.

#### Examples

* [{{ BASE_URL }}/api/v1/rna/?page_size=5](/api/v1/rna/?page_size=5)
* [{{ BASE_URL }}/api/v1/rna/?page=2&page_size=5](/api/v1/rna/?page_size=5&page=2)

<h2 id="v1-output-formats">Output formats</h2>

The same url can be viewed in the browser in a human-readable form
and accessed programmatically in a computer-readable form using a process
called [content negotiation](http://en.wikipedia.org/wiki/Content_negotiation).

The following output formats are currently supported, with more options coming soon:

* **JSON**
* **YAML**
* **HTML**

The output format can be specified using the `format` url parameter.

#### Examples

* [{{ BASE_URL }}/api/v1/rna/URS0000000001/?format=json](/api/v1/rna/URS0000000001/?format=json)
* [{{ BASE_URL }}/api/v1/rna/URS0000000001/?format=yaml](/api/v1/rna/URS0000000001/?format=yaml)
* [{{ BASE_URL }}/api/v1/rna/URS0000000001/?format=api](/api/v1/rna/URS0000000001/?format=api)

Alternatively, one can specify the format using the
http request [Accept headers](http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html):

```
curl -H "Accept: application/json" {{ BASE_URL }}/api/v1/rna/URS0000000001
curl -H "Accept: application/yaml" {{ BASE_URL }}/api/v1/rna/URS0000000001
curl -H "Accept: text/html" {{ BASE_URL }}/api/v1/rna/URS0000000001
```

In case the Accept headers conflict with the `format` parameter, an error message is returned:

```
curl -H "Accept: application/json" {{ BASE_URL }}/api/v1/?format=yaml
or
curl -H "Accept: application/yaml" http://127.0.0.1:8000/api/v1/?format=json
{
  "detail": "Could not satisfy the request's Accept header"
}
```

<h2 id="v1-filtering">Filtering</h2>

The API supports several filtering operations that complement the main RNAcentral search functionality.

<h3 id="v1-filtering-by-sequence-length">Filtering by sequence length</h3>

There are 3 url parameters: `length`, `min_length`, and `max_length`.

#### Examples

* [{{ BASE_URL }}/api/v1/rna/?length=2014](/api/v1/rna/?length=2014)
* [{{ BASE_URL }}/api/v1/rna/?min_length=200000](/api/v1/rna/?min_length=200000)
* [{{ BASE_URL }}/api/v1/rna/?max_length=10](/api/v1/rna/?max_length=10)
* [{{ BASE_URL }}/api/v1/rna/?min_length=1&max_length=4](/api/v1/rna/?min_length=1&max_length=4)

<h3 id="v1-filtering-by-database">Filtering by database</h3>

The expert database can be specified by setting the `database` url parameter.

#### Examples

* [{{ BASE_URL }}/api/v1/rna/?database=1](/api/v1/rna/?database=1) (ENA)
* [{{ BASE_URL }}/api/v1/rna/?database=2](/api/v1/rna/?database=2) (RFAM)
* [{{ BASE_URL }}/api/v1/rna/?database=3](/api/v1/rna/?database=3) (SRPDB)
* [{{ BASE_URL }}/api/v1/rna/?database=4](/api/v1/rna/?database=4) (miRBase)
* [{{ BASE_URL }}/api/v1/rna/?database=5](/api/v1/rna/?database=5) (VEGA)
* [{{ BASE_URL }}/api/v1/rna/?database=6](/api/v1/rna/?database=6) (tmRNA Website)

<h3 id="v1-filtering-by-external-ids">Filtering by external ids</h3>

The external id is an id assigned to a sequence in one of the Expert Databases,
which is imported into RNAcentral as a cross-reference.

The external id can be specified by setting the `external_id` url parameter.

#### Examples

* <a href="/api/v1/rna/?external_id=Stap.epid._AF269831" target="_blank">{{ BASE_URL }}/api/v1/rna/?external_id=Stap.epid._AF269831</a> (SRPDB)
* <a href="/api/v1/rna/?external_id=MIMAT0000091" target="_blank">{{ BASE_URL }}/api/v1/rna/?external_id=MIMAT0000091</a> (miRBase)
* <a href="/api/v1/rna/?external_id=OTTHUMG00000172092" target="_blank">{{ BASE_URL }}/api/v1/rna/?external_id=OTTHUMG00000172092</a> (VEGA)
* <a href="/api/v1/rna/?external_id=Lepto_inter_Lai566" target="_blank">{{ BASE_URL }}/api/v1/rna/?external_id=Lepto_inter_Lai566</a> (tmRNA Website)

<h3 id="v1-combined-filters">Combined filters</h3>

Any filters can be combined to narrow down the query using the `&` symbol as a separator,
which acts as the logical `AND` operator. More logical operators will be supported in the future.

#### Examples

* [{{ BASE_URL }}/api/v1/rna/?database=3&min_length=200](/api/v1/rna/?database=3&min_length=200)
* [{{ BASE_URL }}/api/v1/rna/?min_length=1&max_length=4](/api/v1/rna/?min_length=1&max_length=4)

<h3 id="v1-example-script">Example script</h3>

A common task is finding whether some sequence of interest has an RNAcentral id.

Two example script for **looking up RNAcentral unique sequence ids** (URS) is provided
in **Python** and can be used in more complicated programs.

Instead of sending the entire sequence over the network to the RNAcentral servers,
the script only submits the [md5](http://en.wikipedia.org/wiki/MD5) value
calculated based on the sequence. The md5 value is 32 characters long and is unique
for each sequence. Using md5 saves traffic and decreases the response time.

Internally RNAcentral uses the [Digest::MD5](http://search.cpan.org/dist/Digest-MD5/MD5.pm)
Perl module for computing the md5 values. Additional notes:

* all sequences are uppercase
* md5 is computed for DNA sequences (so all U's should be replaced with T's).

{# embedded GitHub gist #}
<script src="https://gist.github.com/AntonPetrov/177cef0a3b4799f01536.js"></script>

<h2 id='v1-cross-domain-requests'>Cross domain requests</h2>

To use the API in a javascript application, please use jsonp requests.

#### Example using jQuery

```
$.ajax({
    url: '{{ BASE_URL }}/api/v1/rna/URS0000000001?format=jsonp',
    dataType: 'jsonp',
    jsonp: false,
    jsonpCallback: 'callback',
    success: function(data){
        // do something with the data
        console.log(data.rnacentral_id + ', ' + data.sequence);
    },
});
```

<h2 id="v1-trailing-slash">Trailing slash</h2>

The trailing slash in all urls used in the API is **optional**.

#### Examples

Both requests should return the same results, both in the browser and when retrieved programmatically:

* [{{ BASE_URL }}/api/v1](/api/v1)
* [{{ BASE_URL }}/api/v1/](/api/v1/)


{% endmarkdown %}

  <hr>

  </div>

  {# affixed navigation menu #}
  <nav id="affix-nav" class="sidebar col-md-3 hidden-print visible-lg" role="complementary">
    <ul class="nav sidenav affix" data-spy="affix" id="affix-ul">
        <li>
          <a href="#overview">API Overview</a>
          <ul class="nav">
            <li><a href="#web-browsable-api">Web browsable API</a></li>
            <li><a href="#versioning">Versioning</a></li>
            <li><a href="#throttling">Throttling</a></li>
          </ul>
        </li>
        <li>
          <a href="#v1">API v1 documentation</a>
          <ul class="nav">
            <li>
              <a href="#v1-example-response">Example response</a>
              <ul class="nav">
                <li><a href="#v1-hyperlinked-vs-flat-responses">Hyperlinked vs flat responses</a></li>
              </ul>
            </li>
            <li><a href="#v1-pagination">Pagination</a></li>
            <li><a href="#v1-output-formats">Output formats</a></li>
            <li>
              <a href="#v1-filtering">Filtering</a>
              <ul class="nav">
                <li><a href="#v1-filtering-by-sequence-length">Filtering by length</a></li>
                <li><a href="#v1-filtering-by-database">Filtering by database</a></li>
                <li><a href="#v1-filtering-by-external-ids">Filtering by external ids</a></li>
                <li><a href="#v1-combined-filters">Combined filters</a></li>
              </ul>
            </li>
            <li><a href="#v1-example-script">Example script</a></li>
            <li><a href="#v1-cross-domain-requests">Cross-domain requests</a></li>
            <li><a href="#v1-trailing-slash">Trailing slash</a></li>
          </ul>
        </li>
    </ul>
  </nav>

</div>

{% endblock content %}


{% block extra_js %}
  {{ block.super }}

  <script type="text/javascript">
    $(function() {
      // enable scrollspy, required for the affix
      $('body').scrollspy({ target: '#affix-nav' });

      // activate the affix and set its width
      var $affix = $("#affix-ul");
      $affix.affix({
        offset: {
            top: 50
        }
      }).width($affix.parent().width());

      // control the width of the affix element after window resize
      $(window).resize(function () {
        $affix.width($affix.parent().width());
      });

      // open all content links in new windows
      $('.container-main a').not('.sidebar a').not('a.btn').each(function() {
        var $this = $(this);
        $this.html($this.html() + '&nbsp;<i class="fa fa-external-link"></i>').attr('target', '_blank');
      });
    });
  </script>
{% endblock extra_js %}
