{% extends "portal/base.html" %}
{% load static %}

{% block title %}
    Gene: {{ geneName }}{% if geneVersion %}.{{ geneVersion }}{% endif %} - RNAcentral
{% endblock %}

{% block content %}
            <gene-detail 
                gene-name="{{ geneName }}"
                {% if geneVersion %}gene-version="{{ geneVersion }}"{% endif %}
                gene-found="{{ geneFound|yesno:'true,false' }}">
            </gene-detail>
    {% if not geneFound %}
    <div class="row">
        <div class="col-md-12">
            <div class="alert alert-warning" role="alert">
                <h4 class="alert-heading">Gene Not Found</h4>
                <p>The gene <strong>{{ geneName }}</strong>{% if geneVersion %} version {{ geneVersion }}{% endif %} was not found in our database.</p>
                <hr>
                <p class="mb-0">
                    <a href="/search?q={{ geneName }}" class="btn btn-primary">Search for {{ geneName }}</a>
                    <a href="/" class="btn btn-secondary">Go to Homepage</a>
                </p>
            </div>
        </div>
    </div>
    {% endif %}

<!-- Embed data as JavaScript variables for AngularJS component -->
<script>
window.geneDetailData = {
    geneData: {{ geneData|safe }},
    transcriptsData: {{ transcriptsData|safe }},
    externalLinksData: {{ externalLinksData|safe }},
    transcriptsPagination: {{ transcriptsPagination|safe }},
    litsummSummaries: {{ litsummSummaries|safe }},
    geneFound: {{ geneFound|yesno:'true,false' }}
};
</script>
{% endblock %}

{% block extra_js_uncompressed %}
<script>
$(document).ready(function() {
    var litsummData = window.geneDetailData.litsummSummaries || [];
    if (litsummData.length > 1) {
        // Poll until the carousel element exists and has items
        var attempts = 0;
        var maxAttempts = 50;

        var initCarousel = function() {
            attempts++;
            var $carousel = $('#gene-litsumm-carousel');

            if ($carousel.length && $carousel.find('.gene__litsumm-panel').length > 0) {
                if (!$carousel.hasClass('slick-initialized')) {
                    $carousel.slick({
                        draggable: true,
                        dots: true,
                        infinite: false,
                        slidesToShow: 1,
                        slidesToScroll: 1,
                        arrows: true
                    });
                }
            } else if (attempts < maxAttempts) {
                setTimeout(initCarousel, 100);
            }
        };

        setTimeout(initCarousel, 500);
    }
});
</script>
{% endblock %}