{% extends "portal/base.html" %}
{% load static %}

{% block title %}
    Gene: {{ geneName }}{% if geneVersion %}.{{ geneVersion }}{% endif %} - RNAcentral
{% endblock %}

{% block content %}
            <gene-detail 
                gene-name="{{ geneName }}"
                {% if geneVersion %}gene-version="{{ geneVersion }}"{% endif %}
                gene-found="{{ geneFound|yesno:'true,false' }}">
            </gene-detail>
    {% if not geneFound %}
    <div class="row">
        <div class="col-md-12">
            <div class="alert alert-warning" role="alert">
                <h4 class="alert-heading">Gene Not Found</h4>
                <p>The gene <strong>{{ geneName }}</strong>{% if geneVersion %} version {{ geneVersion }}{% endif %} was not found in our database.</p>
                <hr>
                <p class="mb-0">
                    <a href="/search?q={{ geneName }}" class="btn btn-primary">Search for {{ geneName }}</a>
                    <a href="/" class="btn btn-secondary">Go to Homepage</a>
                </p>
            </div>
        </div>
    </div>
    {% endif %}

<!-- Embed data as JavaScript variables for AngularJS component -->
<script>
window.geneDetailData = {
    geneData: {{ geneData|safe }},
    transcriptsData: {{ transcriptsData|safe }},
    externalLinksData: {{ externalLinksData|safe }},
    transcriptsPagination: {{ transcriptsPagination|safe }},
    litsummSummaries: {{ litsummSummaries|safe }},
    geneFound: {{ geneFound|yesno:'true,false' }}
};

// Initialize litsumm carousel after AngularJS renders the content
$(document).ready(function() {
    var litsummData = window.geneDetailData.litsummSummaries || [];
    if (litsummData.length > 1) {
        // Wait for AngularJS to render the carousel items
        var initCarousel = function() {
            var $carousel = $('#gene-litsumm-carousel');
            var itemCount = $carousel.children('.gene__litsumm-panel').length;

            if (itemCount >= litsummData.length && !$carousel.hasClass('slick-initialized')) {
                $carousel.slick({
                    draggable: true,
                    rows: 1,
                    dots: true,
                    infinite: true,
                    lazyLoad: 'ondemand',
                    slidesToShow: 1,
                    slidesToScroll: 1,
                    arrows: true
                });
            } else if (itemCount < litsummData.length) {
                // Retry if items not yet rendered
                setTimeout(initCarousel, 100);
            }
        };
        setTimeout(initCarousel, 500);
    }
});
</script>
{% endblock %}