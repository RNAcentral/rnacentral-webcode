{% load static %}

<!-- Training Widget -->
<div class="row well well-sm">
  <div id="training-widget-root"></div>
</div>

<!-- Load EMBL VF styles for the training widget -->
<link rel="stylesheet" href="https://assets.emblstatic.net/vf/v2.5.14/css/styles.css">
<link rel="stylesheet" href="https://ebi.emblstatic.net/web_guidelines/EBI-Icon-fonts/v1.3/fonts.css" type="text/css" media="all" />

<!-- VF Tabs initialization function -->
<script>
(function() {
  if (typeof window.vfTabs !== 'undefined') {
    return; // Already defined
  }
  
  function vfTabs(scope, activateDeepLinkOnLoad) {
    var scope = scope || document;
    var activateDeepLinkOnLoad = activateDeepLinkOnLoad || true;
    const tabsList = scope.querySelectorAll("[data-vf-js-tabs]");
    const panelsList = scope.querySelectorAll("[data-vf-js-tabs-content]");
    const panels = scope.querySelectorAll(
      "[data-vf-js-tabs-content] [id^='vf-tabs__section']"
    );
    const tabs = scope.querySelectorAll("[data-vf-js-tabs] .vf-tabs__link");
    
    if (!tabsList || !panels || !tabs) {
      return;
    }
    if (tabsList.length == 0 || panels.length == 0 || tabs.length == 0) {
      return;
    }
    
    Array.prototype.forEach.call(tabs, (tab, i) => {
      const tabId = tab.href.split("#")[1];
      tab.setAttribute("role", "tab");
      tab.setAttribute("id", tabId);
      tab.setAttribute("data-tabs__item", tabId);
      tab.setAttribute("tabindex", "0");
      tab.parentNode.setAttribute("role", "presentation");
      tab.removeAttribute("aria-selected");
      tab.setAttribute("tabindex", "-1");
      tab.classList.remove("is-active");
      
      // Handle clicking of tabs for mouse users
      tab.addEventListener("click", e => {
        e.preventDefault();
        vfTabsSwitch(e.currentTarget, panels);
      });
      
      tab.addEventListener("keydown", e => {
        let index = Array.prototype.indexOf.call(tabs, e.currentTarget);
        let dir =
          e.which === 37 ?
          index - 1 :
          e.which === 39 ?
          index + 1 :
          e.which === 40 ?
          "down" :
          null;
        if (dir !== null) {
          e.preventDefault();
          dir === "down" ?
            panels[i].focus({
              preventScroll: true
            }) :
            tabs[dir] ?
            vfTabsSwitch(tabs[dir], panels) :
            void 0;
        }
      });
    });
    
    Array.prototype.forEach.call(panels, panel => {
      panel.setAttribute("role", "tabpanel");
      panel.setAttribute("tabindex", "-1");
      panel.setAttribute("aria-labelledby", panel.id);
      panel.hidden = true;
    });
    
    Array.prototype.forEach.call(tabsList, tabsListset => {
      tabsListset.setAttribute("role", "tabsList");
      let firstTab = tabsListset.querySelectorAll(".vf-tabs__link")[0];
      firstTab.removeAttribute("tabindex");
      firstTab.setAttribute("aria-selected", "true");
      firstTab.classList.add("is-active");
    });
    
    Array.prototype.forEach.call(panelsList, panel => {
      let firstPanel = panel.querySelectorAll(".vf-tabs__section")[0];
      firstPanel.hidden = false;
    });
    
    if (activateDeepLinkOnLoad) {
      vfTabsDeepLinkOnLoad(tabs, panels);
    }
  }
  
  function vfTabsSwitch(newTab, panels) {
    const data = newTab.getAttribute("id");
    let parentTabSet = newTab.closest(".vf-tabs__list");
    let oldTab = parentTabSet.querySelector("[aria-selected]");
    
    if (oldTab) {
      oldTab.removeAttribute("aria-selected");
      oldTab.setAttribute("tabindex", "-1");
      oldTab.classList.remove("is-active");
      for (let item = 0; item < panels.length; item++) {
        const panel = panels[item];
        if (panel.id === oldTab.id) {
          panel.hidden = true;
          break;
        }
      }
    }
    
    newTab.focus({
      preventScroll: true
    });
    newTab.removeAttribute("tabindex");
    newTab.setAttribute("aria-selected", "true");
    newTab.classList.add("is-active");
    
    for (let item = 0; item < panels.length; item++) {
      const panel = panels[item];
      if (panel.id === newTab.id) {
        panel.hidden = false;
        break;
      }
    }
  }

  function vfTabsDeepLinkOnLoad(tabs, panels) {
    if (window.location.hash) {
      var hash = window.location.hash.substring(1);
    } else {
      return false;
    }
    
    Array.prototype.forEach.call(tabs, tab => {
      let tabId = tab.getAttribute("data-tabs__item");
      if (tabId == hash) {
        vfTabsSwitch(tab, panels);
      }
    });
  }
  
  // Make vfTabs available globally
  window.vfTabs = vfTabs;
  window.vfTabsSwitch = vfTabsSwitch;
})();
</script>