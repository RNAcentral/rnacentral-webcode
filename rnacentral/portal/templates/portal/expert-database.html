<!--
Copyright [2009-2014] EMBL-European Bioinformatics Institute
Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at
     http://www.apache.org/licenses/LICENSE-2.0
Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

{% extends "portal/base.html" %}
{% load staticfiles %}
{% load humanize %}

{% block title %}
  {{ expert_db.display_name }} Expert Database
{% endblock %}

{% block content %}

<h1>
  <a href="{{ expert_db.url }}" target="_blank" class="expert-db-logo">
    <img src="{% static 'img/expert-db-logos/' %}{{expert_db.label}}.png" alt="{{expert_db.display_name}} logo" class="img-rounded">
  </a>
  {{ expert_db.display_name }} Expert Database
</h1>

<div class="row">
  <div class="col-md-12">
    <p>
      <a href="{{expert_db.url}}" target="_blank">{{expert_db.display_name}}</a>
      {% if expert_db.abbreviation %}
        ({{expert_db.abbreviation}})
      {% endif %}
      {{expert_db.description}}.
    </p>
  </div>
</div>

<div class="row">

<div class="col-md-6">

  <h2>Statistics</h2>
  <ul>
    <li>
      <strong>{{ expert_db.num_sequences|intcomma }}</strong> sequences
      from <strong>{{ expert_db.num_organisms|intcomma }}</strong> organism{{ expert_db.num_organisms|pluralize}}.
    </li>
    <li>
      The shortest sequence has <strong>{{ expert_db.min_length|intcomma }}</strong> nucleotides, the longest <strong>{{ expert_db.max_length|intcomma }}</strong>.
    </li>
    <li>
      The average length is <strong>{{ expert_db.avg_length|floatformat:"0" }}</strong> nucleotide{{ expert_db.avg_length|pluralize }}.
    </li>
  </ul>

    <h2>Example entries</h2>
    <p>
    {% for example in expert_db.examples %}
      <a href="{% url 'portal.views.rna_view' upi=example %}">{{ example }}</a>{% if not forloop.last %},{% else %}.{% endif %}
    {% endfor %}
    </p>

    <p>
      <a class="btn btn-primary" ng-click="meta_search('expert_db:{{expert_db.display_name}}')">Browse all sequences</a>
    </p>

    <h2>Links</h2>
    <ul>
      <li><a href="{{ expert_db.url }}" target="_blank">{{ expert_db.display_name }} homepage</a></li>
      {% if expert_db.project_id %}
        <li><a href="http://www.ebi.ac.uk/ena/data/view/{{ expert_db.project_id }}" target="_blank">ENA project</a></li>
      {% endif %}
    </ul>

  <div class="references">

    <h2>References</h2>

    {% if expert_db.display_name == 'miRBase' %}
      <blockquote>
        <strong>
          miRBase: integrating microRNA annotation and deep-sequencing data.
        </strong>
        <br>
          Kozomara A., Griffiths-Jones S.
        <small>
          Nucleic Acids Res. 39(Database issue): D152-7 (2011 Jan)
        </small>
      </blockquote>
    {% elif expert_db.display_name == 'SRPDB' %}
        <blockquote>
          <strong>
            Kinship in the SRP RNA family.
          </strong>
          <br>
            Rosenblad MA., Larsen N., Samuelsson T., Zwieb C.
          <small>
            RNA Biol 6(5): 508-516 (2009 Nov-Dec)
          </small>
        </blockquote>

        <blockquote>
          <strong>
            The tmRDB and SRPDB resources.
          </strong>
          <br>
            Andersen ES., Rosenblad MA., Larsen N., Westergaard JC., Burks J., Wower IK., Wower J., Gorodkin J., Samuelsson T., Zwieb C.
          <small>
            Nucleic Acids Res. 34(Database issue): D163-8 (2006 Jan)
          </small>
        </blockquote>
    {% elif expert_db.display_name == 'VEGA' %}
        <blockquote>
          <strong>
            The GENCODE v7 catalog of human long noncoding RNAs: analysis of their gene structure, evolution, and expression.
          </strong>
          <br>
            Derrien T., Johnson R., Bussotti G., Tanzer A., Djebali S., Tilgner H., Guernec G., Martin D., Merkel A., Knowles DG. et al.
          <small>
              Genome Res. 22(9): 1775-1789 (2012 Sep)
          </small>
        </blockquote>

        <blockquote>
          <strong>
              GENCODE: the reference human genome annotation for The ENCODE Project.
          </strong>
          <br>
            Harrow J., Frankish A., Gonzalez JM., Tapanari E., Diekhans M., Kokocinski F., Aken BL., Barrell D., Zadissa A., Searle S. et al.
          <small>
            Genome Res. 22(9): 1760-1774 (2012 Sep)
          </small>
        </blockquote>
    {% elif expert_db.display_name == 'tmRNA Website' %}
        <blockquote>
          <strong>
            The tmRNA website: reductive evolution of tmRNA in plastids and other endosymbionts.
          </strong>
          <br>
            Gueneau de Novoa P., Williams KP.
          <small>
            Nucleic Acids Res. 32(Database issue): D104-8 (2004 Jan).
          </small>
        </blockquote>
    {% endif %}
  </div>

</div>

<div class="col-md-6 hidden-xs">

  <ul class="nav nav-tabs">
    <li class="active"><a data-target="#seq-length" data-toggle="tab">Sequence length</a></li>
    <li><a data-target="#species" data-toggle="tab">Species sunburst</a></li>
  </ul>

  <div class="tab-content">
    <div class="tab-pane active" id="seq-length">
      <div class="panel panel-default">
        <div class="panel-body">
          <div id="d3-seq-length-distribution"></div>
        </div>
      </div>
    </div>

    <div class="tab-pane" id="species">
      <div class="panel panel-default">
        <div class="panel-body">
          <div id="d3-species-sunburst"></div>
          {% if expert_db.descr == 'ENA' or expert_db.descr == 'RFAM' %}
            Too many species to display.
          {% endif %}
        </div>
      </div>
    </div>
  </div>

</div>

</div> {# row #}

{% endblock content %}

{% block extra_js %}
    {{ block.super }}
    <script src="{% static "js/vendor/d3/d3.min.js" %}"></script>
    <script src="{% static "js/d3/d3.ExpertDatabaseSequenceDistribution.js" %}"></script>
    <script type="text/javascript" src="{% static "js/d3/d3.speciesSunburst.js" %}"></script>
{% endblock extra_js %}

{% block extra_js_uncompressed %}
    {{ block.super }}

    <script type="text/javascript">
        $(function(){
            var data = {% autoescape off %}{{expert_db_stats.length_counts}}{% endautoescape %};
            ExpertDatabaseSequenceDistribution("#d3-seq-length-distribution", data, 500, 300);
            {% if expert_db.descr != 'ENA' and expert_db.descr != 'RFAM' %}
                data = {% autoescape off %}{{expert_db_stats.taxonomic_lineage}}{% endautoescape %};
                d3SpeciesSunburst(data, '#d3-species-sunburst', 500, 300);
            {% endif %}
        });
  </script>

{% endblock extra_js_uncompressed %}
