<div class="row" ng-if="!vm.error">
  <div class="col-md-12">
    <header class="gene__header">
      <div class="gene-container">
        <div class="gene-title">
          <h1 class="gene-name">{{ vm.geneData.name }}</h1>
          <span class="gene-symbol" ng-if="vm.geneData.symbol && vm.geneData.symbol !== vm.geneData.name">{{ vm.geneData.symbol }}</span>
          <span class="gene-version" ng-if="vm.geneData.version">.{{ vm.geneData.version }}</span>
        </div>
        
        <div class="gene__widget-header">
          <h2 class="gene__widget-title">Gene Summary</h2>
        </div>
        <p class="gene__summary">
          <strong>{{ vm.geneData.name }}</strong> {{ vm.geneData.summary }}
        </p>
        
        <div class="gene-info">
          <div class="gene__info-item" ng-if="vm.hasValue(vm.geneData.chromosome)">
            <span class="gene__info-label">Chromosome</span>
            <span class="gene__info-value">{{ vm.formatValue(vm.geneData.chromosome) }}</span>
          </div>
          <div class="gene__info-item" ng-if="vm.hasValue(vm.geneData.startPosition)">
            <span class="gene__info-label">Start Position</span>
            <span class="gene__info-value">{{ vm.formatValue(vm.geneData.startPosition) }}</span>
          </div>
          <div class="gene__info-item" ng-if="vm.hasValue(vm.geneData.endPosition)">
            <span class="gene__info-label">End Position</span>
            <span class="gene__info-value">{{ vm.formatValue(vm.geneData.endPosition) }}</span>
          </div>
          <div class="gene__info-item" ng-if="vm.hasValue(vm.geneData.strand)">
            <span class="gene__info-label">Strand</span>
            <span class="gene__info-value">{{ vm.formatValue(vm.geneData.strand) }}</span>
          </div>
          <div class="gene__info-item" ng-if="vm.hasValue(vm.geneData.geneType)">
            <span class="gene__info-label">Gene Type</span>
            <span class="gene__info-value">{{ vm.formatValue(vm.geneData.geneType) }}</span>
          </div>
          <div class="gene__info-item" ng-if="vm.hasValue(vm.geneData.length)">
            <span class="gene__info-label">Length</span>
            <span class="gene__info-value">{{ vm.formatValue(vm.geneData.length) }} bp</span>
          </div>
        </div>
      </div>
    </header>

    <main class="gene__main-content">
      <div class="gene-container">
        <div class="gene__tabs">
          <div class="gene__tab" 
               ng-class="{active: vm.activeTab === 'transcripts'}"
               ng-click="vm.showTab('transcripts')">Transcripts</div>
          <div class="gene__tab" 
               ng-class="{active: vm.activeTab === 'genome-browser'}"
               ng-click="vm.showTab('genome-browser')">Genome Browser</div>
        </div>

        <div class="gene__tab-content">
          <!-- Transcripts Tab -->
          <div class="gene__tab-pane" ng-class="{active: vm.activeTab === 'transcripts'}">
            <div class="gene__widget">
              <div class="gene__widget-header">
                <h2 class="gene__widget-title">Transcript Variants</h2>
              </div>
              <div class="gene__transcript-list" ng-if="vm.hasTranscripts()">
                <div class="gene__transcript-item" 
                     ng-repeat="transcript in vm.transcripts"
                     ng-click="vm.onTranscriptClick(transcript)">
                  <div class="gene__transcript-header">
                    <span class="gene__transcript-id">{{ transcript.id }}</span>
                    <span class="gene__transcript-type">{{ transcript.type }}</span>
                  </div>
                  <div class="gene__transcript-details" ng-if="transcript.expanded">
                    <div ng-if="transcript.length"><strong>Length:</strong> {{ transcript.length }}</div>
                    <div ng-if="transcript.exons"><strong>Exons:</strong> {{ transcript.exons }}</div>
                    <div ng-if="transcript.cdsLength"><strong>CDS Length:</strong> {{ transcript.cdsLength }}</div>
                    <div ng-if="transcript.protein"><strong>Protein:</strong> {{ transcript.protein }}</div>
                    <div ng-if="transcript.uniProt"><strong>UniProt:</strong> {{ transcript.uniProt }}</div>
                    <div ng-if="transcript.tsl"><strong>TSL:</strong> {{ transcript.tsl }}</div>
                  </div>
                </div>
              </div>
              <div ng-if="!vm.hasTranscripts()" class="gene__no-data">
                <p>No transcript data available for this gene.</p>
              </div>
            </div>

            <!-- External Links -->
            <div class="gene__widget" ng-if="vm.hasExternalLinks()">
              <div class="gene__widget-header">
                <h2 class="gene__widget-title">External Links</h2>
              </div>
              <div class="gene__external-links">
                <a ng-repeat="link in vm.externalLinks" 
                   ng-href="{{ link.url }}" 
                   class="gene__external-link"
                   target="_blank"
                   ng-click="vm.onExternalLinkClick(link)">{{ link.name }}</a>
              </div>
            </div>
          </div>

          <!-- Genome Browser Tab -->
          <div class="gene__tab-pane" ng-class="{active: vm.activeTab === 'genome-browser'}">
            <div class="gene__widget">
              <div class="gene__widget-header">
                <h2 class="gene__widget-title">Genome Browser</h2>
              </div>
              <div class="gene__genome-browser">
                <div class="gene__browser-controls">
                  <span ng-if="vm.hasValue(vm.geneData.chromosome) && vm.hasValue(vm.geneData.startPosition) && vm.hasValue(vm.geneData.endPosition)">
                    <strong>Location:</strong> Chr{{ vm.geneData.chromosome }}:{{ vm.formatValue(vm.geneData.startPosition) }}-{{ vm.formatValue(vm.geneData.endPosition) }}
                  </span>
                  <span><strong>Assembly:</strong> GRCh38</span>
                  <span><strong>Zoom:</strong> Gene View</span>
                </div>
                <div class="gene__browser-viewport">
                  <div class="gene__chromosome-track"></div>
                  <div class="gene-track">
                    <!-- Exons with AngularJS event handling -->
                    <div class="exon" 
                         style="left: 5%; width: 3%;"
                         ng-mouseenter="vm.onExonHover(0, true)"
                         ng-mouseleave="vm.onExonHover(0, false)"></div>
                    <div class="exon" style="left: 10%; width: 2%;"></div>
                    <div class="exon" style="left: 15%; width: 4%;"></div>
                    <div class="exon" style="left: 22%; width: 3%;"></div>
                    <div class="exon" style="left: 30%; width: 2%;"></div>
                    <div class="exon" style="left: 35%; width: 5%;"></div>
                    <div class="exon" style="left: 45%; width: 3%;"></div>
                    <div class="exon" style="left: 52%; width: 4%;"></div>
                    <div class="exon" style="left: 60%; width: 3%;"></div>
                    <div class="exon" style="left: 68%; width: 2%;"></div>
                    <div class="exon" style="left: 75%; width: 6%;"></div>
                    <div class="exon" style="left: 85%; width: 4%;"></div>
                    
                    <!-- Introns -->
                    <div class="intron" style="left: 5%; width: 90%;"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>
</div>

<!-- Error/Not Found State -->
<div class="row" ng-if="vm.error">
  <div class="col-md-12">
    <div class="alert alert-warning" role="alert">
      <h4 class="alert-heading">Gene Not Found</h4>
      <p>{{ vm.error }}</p>
      <hr>
      <p class="mb-0">
        <a href="/search?q={{ vm.geneName }}" class="btn btn-primary">Search for {{ vm.geneName }}</a>
        <a href="/" class="btn btn-secondary">Go to Homepage</a>
      </p>
    </div>
  </div>
</div>