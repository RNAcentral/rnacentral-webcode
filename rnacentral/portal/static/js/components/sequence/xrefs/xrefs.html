<div>
  <h2>
    Annotations
    <small id="annotations-datatables-counter">{{ $ctrl.xrefs.length | number }} total</small>

    <div class="btn-group btn-group-xs margin-left-5px btn-group-xref-sort" style="display:none">
      <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
        Sort by<span class="caret"></span>
      </button>
      <ul class="dropdown-menu" role="menu">
        <li><a id="sort-by-first-seen">first seen</a></li>
        <li><a id="sort-by-last-seen">last seen</a></li>
      </ul>
    </div>

    <span id="annotations-datatables-filter"></span>
  </h2>

  <table class="table table-hover table-condensed table-bordered" id="annotations-table">

    <thead>
      <tr>
        <th>Database</th>
        <th>Description</th>
        <th>Species</th>
        <th>First&nbsp;seen</th>
        <th>Last&nbsp;seen</th>
        <th>Genomic coordinates available</th>
      </tr>
    </thead>

    <tbody>
      <tr ng-repeat="xref in $ctrl.xrefs" ng-class="{ 'warning': xref.deleted == 'Y' }">
        <td ng-switch="xref.database">
          <span ng-switch-when="'PDBe'">PDB</span>
          <span ng-switch-when="'Vega'">Vega<br>(GENCODE)</span>
          <span ng-switch-default>{{ xref.database }}</span>
        </td>

        <!-- accession -->
        <td ng-switch on="xref.database">
          <strong>{{ xref.accession.description }}</strong>
          <br>
          <i class="fa fa-angle-right"></i>
          <!-- ENA -->
          <span ng-switch-when="ENA">
            ENA: <a ng-href="{{ xref.accession.ena_url }}" target="_blank" ng-attr-title="{{ xref.accession.accession }} at ENA">{{ xref.accession.accession }}</a>
          </span>
          <!-- Rfam -->
          <span ng-switch-when="Rfam">
            RFAM family: <a ng-href="{{ xref.accession.expert_db_url }}" target="_blank">{{ xref.accession.external_id }}</a> ({{ xref.accession.optional_id }}),
            <span ng-if="xref.is_rfam_seed" class="text-success">seed alignment</span> <i class="fa fa-info-circle help" title="part of a manually curated RFAM seed alignment"></i>
            <span ng-if="!xref.is_rfam_seed" class="text-danger">full alignment</span> <i class="fa fa-info-circle help" title="part of an automatically built RFAM full alignment"></i>
            <br>
            <i class="fa fa-angle-right"></i>
            Source ENA entry: <a ng-href="{{ 'http://www.ebi.ac.uk/ena/data/view/' +  xref.accession.parent_ac + '.' + xref.accession.seq_version }}" target="_blank">{{ xref.accession.parent_ac }}.{{ xref.accession.seq_version }}</a>
            (nucleotides {{ xref.accession.feature_start | number }}:{{ xref.accession.feature_end | number }})
          </span>
          <!-- SRPDB -->
          <span ng-switch-when="SRPDB">
            SRPDB:
            <a class="srpdb-external-url" ng-href="{{ xref.accession.expert_db_url }}.fasta" target="_blank">{{ xref.accession.srpdb_id }}</a>
          </span>

          <!-- lncRNAdb -->
          <span ng-switch-when="lncRNAdb">
            lncRNAdb:
            <a class="lncrnadb-external-url" ng-href="{{ xref.accession.expert_db_url }}" target="_blank">{{ xref.accession.optional_id }}</a>
          </span>

          <!-- gtRNAdb -->
          <span ng-switch-when="gtRNAdb">
            gtRNAdb:
            <a class="gtrnadb-external-url" ng-href="{{ xref.accession.expert_db_url }}" target="_blank">{{ xref.accession.external_id }}</a>
          </span>

          <!-- miRBase -->
          <span ng-switch-when="miRBase">
            miRBase:
            <a class="mirbase-external-url" ng-href="{{ xref.accession.expert_db_url }}" target="_blank">{{ xref.accession.external_id }}</a>

            <span ng-if="xref.accession.feature_name == 'precursor_RNA'">
              - precursor miRNA (<ng-pluralize count="xref.mirbase_mature_products.length" when="{'one': 'mature product', 'other': 'mature products'}"></ng-pluralize>
              <span ng-repeat="matureProduct in xref.mirbase_mature_products">
                <a ng-href="{{ matureProduct + "/" + xref.taxid }}">{{ matureProduct.split('/').pop() }}</a>{{$last ? '' : ', '}}
              </span>)
            </span>
            <span ng-if="!xref.accession.feature_name == 'precursor_RNA'">
              - mature miRNA (precursor <a ng-href="{{ xref.mirna_precursor + '/' + xref.taxid }}">{{ xref.mirna_precursor.split('/').pop() }}</a>)
            </span>
          </span>

          <!-- Vega -->
          <span ng-switch-when="Vega">
            {{ xref.database }} transcript <a href="{{ xref.accession.get_vega_transcript_url }}" target="_blank" title="View the transcript at {{ xref.database }}">{{ xref.accession.external_id }}</a>
            from gene <a href="{{ xref.accession.expert_db_url }}" target="_blank" title="View the gene at {{ xref.database }}">{{ xref.accession.optional_id }}</a>
            <!-- {% with splice_variants=xref.get_vega_splice_variants %}
              {% if splice_variants %}
                <br>
                <i class="fa fa-angle-right"></i>
                {{splice_variants|length}} alternative transcript{{splice_variants|length|pluralize}}:
                <small>
                  {% for splice_variant in splice_variants %}
                    <a href="{% url  'portal.views.rna_view' upi=splice_variant.upi %}/{{ xref.taxid }}">{{ splice_variant.upi }}</a>
                    ({{ splice_variant.length|intcomma }} nts){% if not forloop.last %},{% else %}.{% endif %}
                  {% endfor %}
                </small>
              {% endif %}
            {% endwith %} -->
          </span>

          <!-- tmRNA Website -->
          <span ng-switch-when="tmRNA Website">
            tmRNA Website:
            <a href="{{ xref.accession.expert_db_url }}.html" target="_blank">{{ xref.accession.external_id }}</a>
          </span>

          <!-- RefSeq -->
          <span ng-switch-when="RefSeq">
            RefSeq: <a href="{{ xref.accession.expert_db_url }}" target="_blank">{{ xref.accession.external_id }}.{{ xref.accession.seq_version }}</a>

            <span ng-if="xref.is_active && (xref.refseq_mirna_precursor || xref.refseq_mirna_mature_products)">
              <span ng-if="xref.refseq_mirna_precursor">
                - mature miRNA (precursor <a ng-href="{{ xref.refseq_mirna_precursor + '/' + ctrl.taxid }}">{{ xref.refseq_mirna_precursor }}</a>)
              </span>
              <span ng-if="xref.refseq_mirna_mature_products">
                - precursor miRNA (<ng-pluralize count="xref.refseq_mirna_mature_products.length" when="{'one': 'mature product', 'other': 'mature products'}"></ng-pluralize>
                  <span ng-repeat="matureProduct in xref.refseq_mirna_mature_products"><a ng-href="{{ matureProduct + '/' + $ctrl.taxid }}">{{ matureProduct.split('/').pop() }}</a>{{$last ? '' : ', '}}</span>)
              </span>
            </span>
            <span ng-if="xref.is_active && xref.splice_variants">
              <br>
              <i class="fa fa-angle-right"></i>
              {{ splice_variants.length }} <ng-pluralize count="xref.splice_variants.length" when="{'one': 'alternative product', 'other': 'alternative products'}"></ng-pluralize>
              <small>
                <span ng-repeat="spliceVariant in xref.splice_variants">
                  <a ng-href="{{ spliceVariant + '/' + $ctrl.taxid }}">{{ spliceVariant.split('/').pop() }}</a>
                  ({{ spliceVariant.length | number }} nts) {{$last ? '' : ', '}}
                </span>
              </small>
            </span>
            <span ng-if="xref.ncbi_gene_id">
              <br>
              <i class="fa fa-angle-right"></i>
              NCBI GeneID: <a href="http://www.ncbi.nlm.nih.gov/gene/{{ xref.ncbi_gene_id }}" target="_blank">{{ xref.ncbi_gene_id }}</a>
            </span>
          </span>

          <!-- RDP -->
          <span ng-switch-when="RDP">
            RDP: <a href="{{ xref.accession.expert_db_url }}&format=genbank" target="_blank">{{ xref.accession.external_id }}</a>
          </span>

          <!-- PDBe -->
          <span ng-switch-when="PDBe">
            PDB: {{ xref.accession.external_id }}, chain {{ xref.accession.optional_id }}
            <br>
            <i class="fa fa-angle-right"></i>
            <a href="http://www.ebi.ac.uk/pdbe/entry/pdb/{{ xref.accession.external_id }}/RNA/{{ xref.accession.get_pdb_entity_id }}" target="_blank" title="Protein Data Bank in Europe" class="help">PDBe</a> |
            <a href="http://www.pdb.org/pdb/pdb/explore/explore.do?structureId={{ xref.accession.external_id }}" target="_blank" title="Protein Data Bank USA" class="help">RCSB PDB</a> |
            <a href="http://pdbj.org/mine/summary/{{ xref.accession.external_id }}" target="_blank" title="Protein Data Bank Japan" class="help">PDBj</a> |
            <a href="{{ xref.get_ndb_external_url }}" target="_blank" title="Nucleic Acids Database" class="help">NDB</a>
            <br>
            <i class="fa fa-angle-right"></i>
            <small>Structure title:</small> {{ xref.accession.get_pdb_structured_note.structureTitle }}
            <br>
            <i class="fa fa-angle-right"></i>
            <small>Method:</small> {{ xref.accession.get_pdb_structured_note.experimentalTechnique }} |
            <span ng-if="xref.accession.get_pdb_structured_note.resolution">
              <!-- NMR structures do not have resolution -->
              <small>resolution:</small> {{ xref.accession.get_pdb_structured_note.resolution }} Ã… |
            </span>
            <small>release date:</small> {{ xref.accession.get_pdb_structured_note.releaseDate }}
          </span>

          <!-- snOPY -->
          <span ng-switch-when="snOPY">
            snOPY: <a href="{{ xref.accession.expert_db_url }}" target="_blank">{{ xref.accession.external_id }}</a>
          </span>

          <!-- SGD -->
          <span ng-switch-when="SGD">
            {{ xref.database }}: <a href="{{ xref.accession.expert_db_url }}" target="_blank">{{ xref.accession.external_id }}</a> ({{ xref.accession.optional_id }})
          </span>

          <!-- TAIR -->
          <span ng-switch-when="TAIR">
            {{ xref.database }}: <a href="{{ xref.accession.expert_db_url }}" target="_blank">{{ xref.accession.external_id }}</a> (locus {{ xref.accession.optional_id }})
          </span>

          <!-- WormBase -->
          <span ng-switch-when="WormBase">
            {{ xref.database }}: <a href="{{ xref.accession.expert_db_url }}" target="_blank">{{ xref.accession.external_id }}</a> <span class="small text-muted">(gene)</span> |
            <a href="http://www.wormbase.org/species/c_elegans/transcript/{{ xref.accession.optional_id }}" target="_blank">{{ xref.accession.optional_id }}</a> <span class="small text-muted">(transcript)</span>
          </span>

          <!-- PLncDB -->
          <span ng-switch-when="PLncDB">
            {{ xref.database }}: <a href="{{ xref.accession.expert_db_url }}" target="_blank">{{ xref.accession.external_id }}</a>
          </span>

          <span ng-switch-when="dictyBase">
            {{ xref.database }} gene <a href="{{ xref.accession.expert_db_url }}" target="_blank">{{ xref.accession.external_id }}</a>
          </span>

          <!-- SILVA -->
          <span ng-switch-when="SILVA">
            {{ xref.database }}: <a href="{{ xref.accession.expert_db_url }}" target="_blank">{{ xref.accession.external_id }}</a>
            <span ng-if="xref.accession.feature_start < xref.accession.feature_end">
              nucleotides ({{ xref.accession.feature_start | number }} - {{ xref.accession.feature_end | number }})
            </span>
            <span ng-if="!xref.accession.feature_start < xref.accession.feature_end">
              nucleotides ({{ xref.accession.feature_end | number }} - {{ xref.accession.feature_start | number }})
            </span>
          </span>

          <!-- Greengenes -->
          <span ng-switch-when="Greengenes">
            <a href="{{ xref.accession.expert_db_url }}" target="_blank">{{ xref.accession.parent_ac }}.{{ xref.accession.seq_version }}</a>
            <span ng-if="xref.accession.feature_start < xref.accession.feature_end">
              nucleotides ({{ xref.accession.feature_start | number }} - {{ xref.accession.feature_end | number }})
            </span>
            <span ng-if="!xref.accession.feature_start < xref.accession.feature_end">
              nucleotides ({{ xref.accession.feature_end | number }} - {{ xref.accession.feature_start | number }})
            </span>
          </span>

          <!-- PomBase -->
          <span ng-switch-when="PomBase">
            {{ xref.database }}: <a href="{{ xref.accession.expert_db_url }}" target="_blank">{{ xref.accession.external_id }}</a>
          </span>

          <!-- Noncode -->
          <span ng-switch-when="NONCODE">
            {{ xref.database }}: transcript <a href="{{ xref.accession.expert_db_url }}" target="_blank">{{ xref.accession.external_id }}</a>,
            gene <a href="http://www.noncode.org/show_gene.php?id={{ xref.accession.optional_id }}" target="_blank">{{ xref.accession.optional_id }}</a>
          </span>

          <!-- LNCipedia -->
          <span ng-switch-when="LNCipedia">
            {{ xref.database }}: transcript <a href="{{ xref.accession.expert_db_url }}" target="_blank">{{ xref.accession.external_id }}</a>,
            gene <a href="http://www.lncipedia.org/db/gene/{{ xref.accession.optional_id }}" target="_blank">{{ xref.accession.optional_id }}</a>
          </span>

          <!-- Modomics -->
          <span ng-switch-when="Modomics">
            {{ xref.database }}: <a href="{{ xref.accession.expert_db_url }}" target="_blank">{{ xref.accession.external_id }} alignment</a>
          </span>

          <!-- HGNC -->
          <span ng-switch-when="HGNC">
            {{ xref.database }}: <a href="{{ xref.accession.expert_db_url }}" target="_blank">{{ xref.accession.external_id }}</a> ({{ xref.accession.accession }})
            <!-- {% with ensembl_gene_id=xref.accession.get_hgnc_ensembl_id %}
              {% if ensembl_gene_id %}
                <br>
                <i class="fa fa-angle-right"></i>
                Ensembl: <a href="http://www.ensembl.org/Homo_sapiens/Gene/Summary?g={{ ensembl_gene_id }}" target="_blank">{{ ensembl_gene_id }}</a>
              {% endif %}
            {% endwith %} -->
          </span>

          <span ng-switch-default>
            {{ xref.accession.external_id }} {{ xref.accession.optional_id }}
          </span>

          <span ng-if="xref.database == 'Modomics' || xref.database == 'PDBe'">
            <br>
            <i class="fa fa-angle-right"></i>
            <span class="small" ng-if="xref.has_modified_nucleotides">
              <!-- {% with modifications=xref.get_distinct_modifications %}
                <button class="btn btn-primary btn-xs" data-modifications="{{ xref.get_modifications_as_json }}">
                  <i class="fa fa-crosshairs"></i> View modification{{modifications|length|pluralize}}
                </button>
                {% for modification in modifications %}
                  {% if modification.modification_id.source = 'PDB' %}
                    {{ modification.modification_id.description }}
                    (<a class="help" target="_blank"
                       title="{{ modification.modification_id.id }}"
                       href="{{ modification.modification_id.get_pdb_url }}">PDBe</a>){% if not forloop.last %},{% endif %}
                  {% endif %}

                  {% if modification.modification_id.source = 'Modomics' %}
                    {{ modification.modification_id.description }}
                    (<a class="help" target="_blank"
                       title="{{ modification.modification_id.id }}"
                       href="{{ modification.modification_id.get_modomics_url }}">Modomics</a>
                    {% if modification.modification_id.get_pdb_url %} |
                      <a class="help" target="_blank"
                         title="{{ modification.modification_id.ccd_id }}"
                         href="{{ modification.modification_id.get_pdb_url }}">PDBe</a>){% if not forloop.last %},{% endif %}
                    {% else %}
                    ){% if not forloop.last %},{% endif %}
                    {% endif %}
                  {% endif %}
                {% endfor %}
              {% endwith %} -->
            </span>
            <span class="small" ng-if="!xref.has_modified_nucleotides">
              No modified nucleotides.
            </span>
          </span>

          <span ng-if="xref.accession.organelle">
            <br>
            <i class="fa fa-angle-right"></i>
            found in {{ xref.accession.organelle | lowercase }}
          </span>

          <span ng-if="xref.accession.is_composite == 'Y'">
            <br>
            <i class="fa fa-angle-right"></i>
            Source ENA entry: <a href="{{ xref.accession.get_ena_url }}" target="_blank" ng-attr-title="{{ xref.accession.non_coding_id }} at ENA">{{ xref.accession.non_coding_id }}</a>
          </span>

          <!-- show genomic locations for non-human species -->
          <span ng-if="xref.coordinates">
            <br>
            <i class="fa fa-angle-right"></i>
            <!-- {% with genomic_coordinates=xref.get_genomic_coordinates %}
              <button type="button" class="btn btn-primary btn-xs genoverse-xref help margin-right-5px" data-genomic-start="{{ genomic_coordinates.start }}" data-genomic-end="{{ genomic_coordinates.end }}" data-strand="{{ genomic_coordinates.strand }}" data-chromosome="{{ genomic_coordinates.chromosome }}" data-species="{{xref.get_ensembl_species_name}}" data-description="{{ xref.accession.description }}" data-species-label="{{ xref.accession.species }}" title="View on this page using Genoverse browser"><i class="fa fa-map-marker"></i> View genomic location</button>
              <small>
                <span class="margin-right-5px">{{ genomic_coordinates.chromosome }}:{{ genomic_coordinates.start|intcomma }}-{{ genomic_coordinates.end|intcomma }}:{{ genomic_coordinates.strand }}</span>
                {# Ensembl url #}
                <span class="margin-right-5px ensembl-link">
                  {% with ensembl_species_name=xref.get_ensembl_species_name %}
                    {% with ensembl_division=xref.get_ensembl_division %}
                      <a href="{{ ensembl_division.url }}/{{ensembl_species_name}}/Location/View?r={{ genomic_coordinates.chromosome }}%3A{{ genomic_coordinates.start }}-{{ genomic_coordinates.end }}" target="_blank">{{ ensembl_division.name }}</a>
                    {% endwith %}
                  {% endwith %}
                </span>
                {# UCSC url #}
                {% with ucsc_db_id=xref.get_ucsc_db_id %}
                  {% if ucsc_db_id %}
                    <span class="margin-right-5px ucsc-link">
                      <a href="http://genome.ucsc.edu/cgi-bin/hgTracks?db={{ ucsc_db_id }}&position={{ genomic_coordinates.ucsc_chromosome }}%3A{{ genomic_coordinates.start }}-{{ genomic_coordinates.end }}" target="_blank">UCSC</a>
                    </span>
                  {% endif %}
                {% endwith %}
              </small>
            {% endwith %} -->
          </span>

          <!-- literature references -->
          <citations xref="xref" on-activate-publications="$ctrl.onActivatePublications()"></citations>

          <span ng-if="xref.deleted == 'Y'">
            <br>
            <small><span class="label label-danger" title="This annotation was removed from the Expert Database">Obsolete</span></small>
          </span>
        </td>

        <!-- accession -->
        <td>
          <!-- Greengenes inferred taxonomy -->
          <span ng-if="xref.database == 'Greengenes'">
            INSDC classification:
            <a href="http://www.ebi.ac.uk/ena/data/view/Taxon:{{ xref.taxid }}" target="_blank" title="{{ xref.accession.classification }}"><em>{{ xref.accession.species }}</em></a>
            <br>
            Greengenes classification: <em>{{ xref.accession.inference }}</em>
          </span>
          <span ng-if="!(xref.database == 'Greengenes')">
            <a href="http://www.ebi.ac.uk/ena/data/view/Taxon:{{ xref.taxid }}" target="_blank" title="{{ xref.accession.classification }}"><em>{{ xref.accession.species }}</em></a>
          </span>
        </td>

        <!-- first seen -->
        <td><time datetime="{{ xref.first_seen | date:'y-M-d' }}">{{ xref.first_seen | date:'d M y' }}</time></td>

        <!-- last seen -->
        <td><time datetime="{{ xref.last_seen | date:'y-M-d' }}">{{ xref.last_seen | date:'d M y' }}</time></td>

        <!-- genomic coordinates available -->
        <td>
          <span ng-if="xref.has_genomic_coordinates">1</span>
          <span ng-if="!xref.has_genomic_coordinates">0</span>
        </td>
      </tr>

    </tbody>

  </table>

  <!-- {% if rna.count_xrefs > context.xref_page_size %}
    <div class="alert alert-warning" role="alert">
      Showing {{ context.xref_page_size|intcomma }} entries out of {{ rna.count_xrefs|intcomma }}.
      Navigate between batches:
      <ul class="pagination pagination-sm">
        {% for xref_page in context.xref_pages %}
          <li {% if context.xref_page_num == forloop.counter %}class="active"{% endif %}>
            <a href="" data-xref-page="{{xref_page}}" class="xref-pagination">{{ xref_page }}</a>
          </li>
        {% endfor %}
      </ul>
    </div>
  {% endif %} -->

  <div ng-if="!$ctrl.xrefs && !$ctrl.error" class="table-responsive force-scrollbars">

    <div class="panel panel-default" id="xrefs-loading">
      <div class="panel-body" id="xrefs-loading-msg">
        <i class="fa fa-spinner fa-spin fa-2x"></i>
        Loading database cross-references...
      </div>
    </div>

    <div id="xrefs-table-div"></div>

  </div> <!-- .table-responsive -->

  <div class="annotations-datatables-controls"></div>
</div>
